{"ast":null,"code":"import VueRouter from \"vue-router\";\nimport Vue from \"vue\";\nimport Entertain from \"@/components/Entertain.vue\";\nimport Learn from \"@/components/Learn.vue\";\nimport Tool from \"@/components/Tool.vue\";\nimport Add from \"@/components/Add.vue\";\nimport Delect from \"@/components/Delect.vue\";\nimport Login from \"@/components/Login.vue\";\nimport Container from \"@/components/Container.vue\";\nimport MainMenu from \"@/components/MainMenu.vue\";\nimport store from \"@/store\";\nVue.use(VueRouter);\nconst router = new VueRouter({\n  routes: [\n  // 动态路径参数 以冒号开头\n  {\n    path: '/',\n    redirect: '/main'\n  }, {\n    name: 'login',\n    path: '/login',\n    component: MainMenu,\n    meta: {\n      requireAuth: false\n    }\n  }, {\n    name: 'main',\n    path: '/main',\n    component: MainMenu,\n    meta: {\n      requireAuth: false\n    },\n    children: [{\n      name: 'learn',\n      path: 'learn',\n      component: Learn,\n      meta: {\n        requireAuth: false\n      }\n    }, {\n      name: 'entertain',\n      path: 'entertain',\n      component: Entertain,\n      meta: {\n        requireAuth: false\n      }\n    }, {\n      name: 'tool',\n      path: 'tool',\n      component: Tool,\n      meta: {\n        requireAuth: false\n      }\n    }, {\n      name: 'add',\n      path: 'add',\n      component: Add,\n      meta: {\n        requireAuth: true\n      }\n    }, {\n      name: \"delect\",\n      path: 'delect',\n      component: Delect,\n      meta: {\n        requireAuth: true\n      }\n    }]\n  }]\n});\nlet isRedirecting = false; // 添加一个标志变量，记录是否正在进行重定向\n\nrouter.beforeEach((to, from, next) => {\n  const token = localStorage.getItem('token');\n  console.log(\"token\", token);\n  console.log(store.state.showLoginModal);\n\n  // 避免循环重定向：如果当前路径是 /login 或者来源路径是 /login，则直接放行\n  if (to.path === '/login' || from.path === '/login') {\n    next();\n    return;\n  }\n  if (to.meta.requireAuth && (!token || token === null || token === \"\")) {\n    if (!isRedirecting) {\n      // 只有在没有进行重定向时才执行重定向操作\n      console.log(\"没有token，跳转到登录页面\");\n      store.commit('showLoginModal');\n      isRedirecting = true; // 设置重定向标志为 true\n      next('/login');\n      console.log(store.state.showLoginModal);\n    } else {\n      next(false); // 如果已经在重定向中，阻止当前导航\n    }\n  } else {\n    isRedirecting = false; // 不需要重定向时，重置标志变量\n    next();\n  }\n});\nexport default router;","map":{"version":3,"names":["VueRouter","Vue","Entertain","Learn","Tool","Add","Delect","Login","Container","MainMenu","store","use","router","routes","path","redirect","name","component","meta","requireAuth","children","isRedirecting","beforeEach","to","from","next","token","localStorage","getItem","console","log","state","showLoginModal","commit"],"sources":["E:/zxuede112333/MyProject/prodjj/src/router/index.js"],"sourcesContent":["import VueRouter from \"vue-router\";\r\nimport Vue from \"vue\";\r\nimport Entertain from \"@/components/Entertain.vue\";\r\nimport Learn from \"@/components/Learn.vue\";\r\nimport Tool from \"@/components/Tool.vue\";\r\nimport Add from \"@/components/Add.vue\";\r\nimport Delect from \"@/components/Delect.vue\";\r\nimport Login from \"@/components/Login.vue\";\r\nimport Container from \"@/components/Container.vue\";\r\nimport MainMenu from \"@/components/MainMenu.vue\";\r\nimport store from \"@/store\";\r\n\r\nVue.use(VueRouter)\r\n\r\nconst router = new VueRouter({\r\n    routes: [\r\n      // 动态路径参数 以冒号开头\r\n      { path:'/', redirect:'/main'},\r\n\r\n      { name:'login', path:'/login', component:MainMenu, meta: { requireAuth: false }},\r\n          \r\n      { name: 'main', path: '/main', component:MainMenu, meta: { requireAuth: false } ,children:[\r\n        { name: 'learn', path: 'learn', component: Learn, meta: { requireAuth: false }},\r\n        { name: 'entertain', path: 'entertain', component: Entertain, meta: { requireAuth: false }},\r\n        { name: 'tool', path: 'tool', component: Tool, meta: { requireAuth: false }},\r\n        { name: 'add', path: 'add', component: Add, meta: { requireAuth: true }},\r\n        { name: \"delect\", path:'delect', component: Delect, meta: { requireAuth: true }}\r\n      ]}\r\n\r\n      \r\n      \r\n      ]\r\n    })\r\n\r\n    let isRedirecting = false; // 添加一个标志变量，记录是否正在进行重定向\r\n\r\n    router.beforeEach((to, from, next) => {\r\n        const token = localStorage.getItem('token');\r\n        console.log(\"token\", token);\r\n        console.log(store.state.showLoginModal);\r\n    \r\n        // 避免循环重定向：如果当前路径是 /login 或者来源路径是 /login，则直接放行\r\n        if (to.path === '/login' || from.path === '/login') {\r\n            next();\r\n            return;\r\n        }\r\n    \r\n        if (to.meta.requireAuth && (!token || token === null || token === \"\")) {\r\n            if (!isRedirecting) { // 只有在没有进行重定向时才执行重定向操作\r\n                console.log(\"没有token，跳转到登录页面\");\r\n                store.commit('showLoginModal');\r\n                isRedirecting = true; // 设置重定向标志为 true\r\n                next('/login');\r\n                console.log(store.state.showLoginModal);\r\n            } else {\r\n                next(false); // 如果已经在重定向中，阻止当前导航\r\n            }\r\n        } else {\r\n            isRedirecting = false; // 不需要重定向时，重置标志变量\r\n            next();\r\n        }\r\n    });\r\n      \r\n    \r\n\r\n  export default router\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}